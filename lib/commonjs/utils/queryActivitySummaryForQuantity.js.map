{"version":3,"names":["_ensureUnit","_interopRequireDefault","require","_prepareOptions","_nativeTypes","_interopRequireWildcard","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","queryActivitySummaryForQuantity","options","subscribe","Boolean","updateCallback","energyUnit","ensureUnit","HKQuantityTypeIdentifier","activeEnergyBurned","UnitOfEnergy","Joules","timeUnit","appleMoveTime","UnitOfTime","Seconds","opts","prepareOptions","queryId","data","Native","from","to","result","map","record","startDate","Date","onUpdate","update","_options$updateCallba","subscription","EventEmitter","addListener","unsubscribe","remove","unsubscribeQuery","_default","exports"],"sources":["queryActivitySummaryForQuantity.ts"],"sourcesContent":["import ensureUnit from './ensureUnit'\nimport prepareOptions from './prepareOptions'\nimport Native, { EventEmitter } from '../native-types'\n\nimport {\n  HKQuantityTypeIdentifier, UnitOfEnergy, UnitOfTime,\n} from '../native-types'\nimport type { GenericQueryOptions, HKActivitySummary, QueryActivitySummaryResponse } from '../types'\n\nconst queryActivitySummaryForQuantity = async <\nTEnergyUnit extends UnitOfEnergy,\nTTimeUnit extends UnitOfTime\n>(\n  options: Omit<GenericQueryOptions, 'anchor' | 'ascending' | 'limit'> & {\n    readonly energyUnit?: TEnergyUnit,\n    readonly timeUnit?: TTimeUnit,\n    readonly updateCallback?: (data: HKActivitySummary<TEnergyUnit, TTimeUnit>[]) => void\n  },\n) => {\n  const subscribe = Boolean(options.updateCallback)\n  const energyUnit = await ensureUnit(HKQuantityTypeIdentifier.activeEnergyBurned, options.energyUnit)\n    ?? UnitOfEnergy.Joules\n  const timeUnit = await ensureUnit(HKQuantityTypeIdentifier.appleMoveTime, options.timeUnit)\n    ?? UnitOfTime.Seconds\n\n  const opts = prepareOptions(options)\n\n  const { queryId, data } = await Native.queryActivitySummaryForQuantity(\n    energyUnit,\n    timeUnit,\n    opts.from,\n    opts.to\n  )\n\n  const result: QueryActivitySummaryResponse<TEnergyUnit, TTimeUnit> = {\n    queryId,\n    data: data.map((record) => {\n      record.startDate = new Date(record.startDate)\n      return record as  (Omit<HKActivitySummary<TEnergyUnit, TTimeUnit>, \"startDate\"> & { startDate: Date })\n    })\n  }\n\n  if (subscribe) {\n    const onUpdate = (\n      update: { queryId: string, data: HKActivitySummary<TEnergyUnit, TTimeUnit>[] }\n    ) => {\n      if (update.queryId === queryId) {\n        options.updateCallback?.(update.data)\n      }\n    }\n    const subscription = EventEmitter.addListener('onActivitySummaryUpdate', onUpdate)\n    \n    result.unsubscribe = async () => {\n      subscription.remove()\n      return Native.unsubscribeQuery(result.queryId)\n    }\n  }\n\n  return result\n}\n\nexport default queryActivitySummaryForQuantity\n"],"mappings":"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"}